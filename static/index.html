<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoidIRC</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="head">
        <h1>VÃ¤lkommen till VoidIRC</h1>
    </header>

    <div class="chat">
        <p>VoidIRC Main Chat</p>
        <hr>
        <ul>
           <li id="message">
            
           </li> 
           
        </ul>
        <hr>
        <input type="text" placeholder="Chat" class="input" id="inputBox">
    </div>

    <script>
        ws = new WebSocket('ws://localhost:8080')
        
        // Handle incoming messages
        ws.onmessage = function(event) {
            const message = JSON.parse(event.data);
            console.log('Received:', message);
            
            const messageList = document.getElementById('message');
            
            if (message.type === 'MSG') {
                messageList.innerHTML += `<div>[${message.room}] ${message.from}: ${message.data}</div>`;
            } else if (message.type === 'JOIN') {
                messageList.innerHTML += `<div style="color: green;">${message.message}</div>`;
            } else if (message.type === 'NICK') {
                messageList.innerHTML += `<div style="color: blue;">${message.message}</div>`;
            } else if (message.type === 'ERROR') {
                messageList.innerHTML += `<div style="color: red;">Error: ${message.message}</div>`;
            } else if (message.type === 'LIST') {
                messageList.innerHTML += `<div>Available rooms: ${message.rooms.join(', ')}</div>`;
            }
        }

        document.getElementById('inputBox').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        });

        function sendMessage() {
            const input = document.getElementById("inputBox");
            const text = input.value.trim();
            
            if (!text) return; // Don't send empty messages
            
            const arrMess = text.split(" ");
            const command = arrMess[0];
            const argument = arrMess.slice(1);

            if (
                command == "/join" ||
                command == "/nick" ||
                command == "/msg"  ||
                command == "/list" ||
                command == "/quit"
            ) {
                const message = {
                    type: command.split("/")[1].toUpperCase(),
                    data: argument
                }
                
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify(message));
                    input.value = ""; // Clear input after sending
                } else {
                    alert("WebSocket not connected");
                }
            } else {
                alert(command + " IS INVALID");
            }
        }

        function receiveMessage(){
            
        }
    </script>
</body>
</html>